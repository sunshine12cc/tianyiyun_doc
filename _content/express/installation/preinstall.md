---
---

# 预安装说明

预安装的目的是配置好服务器Web Installer环境，以便通过 Web Installer 进行青立方超融合易捷版（CloudCube Express）的可视化部署。

针对新购/加购用户，青立方超融合易捷版 (CloudCube Express) 一体机出厂时已预装超融合操作系统，在准备工作完成后参考[场景一：一体机初始化](#场景一一体机初始化)即可。

针对有需求重新安装操作系统的，需要参考[场景二：非一体机安装系统](#场景二非一体机安装系统)，并至少需要准备好**超融合服务器、一个U盘（8G以上）、一台PC（笔记本为佳）、一根网线**。

## 准备工作：硬件环境检查

请参考 [硬件规格](../introduction/configuration.html) 预先准备好超融合服务器。

#### 安装部署网络连线图

**单台万兆网络交换机**

当您只有一台万兆网络交换机进行使用时，两张万兆网卡可使用不在同一张网卡的两个网口做管理/业务网络复用的 Bond；在实际部署时，安装部署脚本会查看剩余的两个万兆网卡的网口，配置两个存储网络的ip（后台默认分配，用户不需要自己区划分网段, 只需要保证网卡间接线正确即可），管理/业务网络网线及存储网络网线连线如下，其中带外管理连线与所用网络交换机为可选：

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190531232911.png)

**两台万兆网络交换机**

当您具备两台万兆网络交换机进行使用时，两张万兆网卡可使用不在同一张网卡的两个网口做管理/业务网络的 Bond；同一个 Bond 的两个网口的连线分别插在两个万兆网络交换机上；在实际部署时，安装部署脚本会查看剩余的两个万兆网卡的网口，自动分配地址构建存储网络。管理/业务网络网线及存储网络网线连线如下，其中带外管理连线与所用网络交换机为可选：

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190531233034.png)

> 提示：建议预先在物理交换机上按需划分多个用于 CloudCube Express 中业务需要使用的 VLAN，然后才可以在 “IP 池” 管理功能中，添加相应的信息（包括 IP 网段，VLAN_ID）。

#### 服务角色部署逻辑图

青立方超融合易捷版管理服务以虚拟机的形式运行在平台之上，主要包含了 KS 相关服务如 Webservice、zookeeper、Cassandra、seed、vbr、snapshot、PostgreDB；VDI 相关桌面管理、调度、监控服务等。分布式存储相关服务以进程的方式运行在物理服务器节点上。

> - DNS：提供内网域名服务
> - Zookeeper：提供节点集群管理
> - Cassandra：平台监控数据管理
> - PostgreDB（pg）：存放平台管理信息的数据库
> - WebService：WebConsole控制台服务
> - Seed: 提供存储镜像模板的节点  
> - Vbr: 提供数据备份服务，用于虚拟机、硬盘的备份 
> - Snapshot: 虚拟备份恢复节点，用于存放备份的节点  
> - VDI 相关消息、调度、api、监控、管理信息交互等服务


![](https://pek3b.qingstor.com/kubesphere-docs/png/20190531233215.png)


> 注意事项
> - 1、确认物理服务器电源、接线都是正确的；
> - 2、万兆网络交换机配置管理及业务使用的 VLAN、服务器跟物理交换机接线端口配置 `trunk` 模式；
> - 3、无论是全闪还是混插配置，系统盘均做 RAID1
> - 4、无论是全闪还是混插配置，闪存盘建议 `直通模式`，不做 RAID；
> - 5、混插配置模式下，对于作为数据盘的机械盘，您需要进行基础的 RAID 配置，比如划分单个 RAID5 或者多个 RAID5；(注：划分的RAID组的数量越多，存储服务会使用更多的线程去处理多张逻辑盘，从而性能会越好，且冗余度高（故障域在单 RAID5 逻辑盘内，即使故障后，受影响的逻辑盘整体容量也较小），但是磁盘的利用率会较低)
> - 例如 12 块磁盘，RAID5 可划分为：
>      - 1） 6块磁盘一组做 RAID5，一共做2个 RAID5 逻辑盘
>      - 2） 4块磁盘一组做 RAID5，一共做3个 RAID5 逻辑盘
>      - 3） 3块磁盘一组做 RAID5，一共做4个 RAID5 逻辑盘
> - 6、混插模式下针对缓存盘和机械容量盘的配置，目前支持以下两种使用的情况：  
>      - 1) 默认采用硬件配置的全部缓存容量，与全部机械盘组成的单个 RAID5，构建存储服务所需的逻辑资源池介质； 
>      - 2) 默认采用硬件配置的全部缓存容量，被机械盘划分的多个 RAID5 进行共享，构建存储服务所需的逻辑资源池介质。

## 场景一：一体机初始化

CloudCube Express 一体机出厂时已**预装**超融合操作系统，并已经设置 ETH0 的 IP 地址为 `100.100.100.100/24`。

**确定 ETH0 物理位置**

您可以通过服务器基本信息配置界面 Boot setting 界面上检验，点击左侧 「网卡检查」，使网卡 ETH0 对应网口上的 LED 不断地闪烁，从而确定其物理位置。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190601083103.png)

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190531022445.png)


### 第一步：配置服务器基本信息

首先您需要配置您的PC（笔记本电脑）与待安装机器环境同网段 IP 地址，若您使用的是 Windows 10 系统，可以参考[这个链接](https://jingyan.baidu.com/article/9f7e7ec05e0bd56f2915547c.html)。其中**IP地址**填写诸如**100.100.100.101**等在`100.100.100.100/24`子网内的地址。**子网掩码**填写**255.255.255.0**，其他可不必填写。

![微信截图_20191012141436](../_images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20191012141436.png)

然后使用网线直连服务器的 ETH0 网卡口，在您的电脑用浏览器打开 `http://100.100.100.100:9998/bootsetting/` 访问 **Boot Setting** 配置网络的界面，根据实际环境信息来配置服务器管理网络。

在该页面，您可以在勾选网卡并检测网卡。如下图。

![微信截图_20191012112927](../_images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20191012112927.png)

然后，您需要在下图红框填写配置信息。

![微信截图_20191012113031](../_images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20191012113031.png)

> 注意事项:
> - 若安装**多台**超融合机器时，需要**分别登录**每台机器以配置网络；
> - 主机名：主机名必须采用这样的格式规范：`ZONE_ID r 机柜位置 n 机器位置`，比如: `pek3r02n02`；
> - IP 地址：此处可自定义物理节点的管理 IP 地址，例如本示例的 3 台物理主机的管理 IP 地址设置为 `172.16.76.3 - 172.16.76.5`；
> - 子网掩码：设置服务器所在网段的子网掩码，例如 `255.255.255.0`；
> - 网关：填写服务器所在网段的网关 IP 地址，例如 `172.16.76.1`；

您可以开启Bond，VLAN，并设置启动节点，如下图。

![微信截图_20191012113354](../_images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20191012113354.png)

> 注意事项：
> 
> - 开启 Bond：如果您的管理 IP 是配置给做了 Bond 的两张网卡的两个网口（一张网卡选一个网口），此时需要勾选此项，然后在左边勾选两张对应网卡，未手动设置Bond的网卡会被自动配置 ；
> - 开启 VLAN：如果您的管理 IP 对应在物理交换机上配置了 VLAN ，无论是分配给了网卡的一个网口（未开启 Bond），还是分配给做了 Bond 的两张网卡的两个网口（开启了 Bond），此时需开启 VLAN 并填入 VLAN ID (从交换机获取)，根据实际情况在左侧勾选目标网口或者构建 Bond 的两个网口；(若 Bond 或 VLAN 都不设置，可自行选择其中一张网卡配置 IP 地址)；
> - 启动节点：多台机器只需要选择其中**任意一台**勾选设置为启动节点，并填写一个额外的与该服务器同网段的空闲 IP 地址，作为 Web Installer 的登录入口。




确认填写无误可以点击**设置**，刷新浏览器后如果该配置页面不再显示，说明配置成功。

### 第二步：访问 Web Installer

浏览器中输入之前填写的启动节点的 IP `http://IP:9998/` 即可访问登陆界面（以本文上图为例，是`http://192.168.0.2:9998/` ），默认登录用户名密码为 `admin/zhu88jie`。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525204851.png)

## 场景二：非一体机安装系统

这个场景主要针对您更换服务器或者更换硬盘后，需要重新安装Web Installer之情况，您需要提前准备好：

> - 1、操作系统镜像 ISO 文件；
> - 2、使用易捷版需要的系统镜像压缩包；
> - 3、`8 GB` 以上容量的 U 盘；
> - 4、浏览器 (如 Chrome)、[UltraISO](https://cn.ultraiso.net/)、[Xshell](http://www.xshellcn.com/) 等工具软件。

### 第一步：刻录 ISO 镜像

> 前提条件：准备所需使用的软件 UltraISO


1、在 PC 设备上插入 U 盘，打开 UltraISO 软碟通，并点击左上角的 “文件” → “打开”，打开目标的安装 ISO 文件。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525204506.png)

2、打开完后回到 UltraISO 窗口，点击菜单栏中的 “启动” 选 “写入硬盘镜像”， 写入的目标选择为 U 盘或光盘，务必勾选 “刻录校验”，写入方式通常 USB-HDD+。 

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525204528.png)

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525204637.png)

### 第二步：安装系统

将制作好的安装 U 盘插入超融合物理机，需要依次对 **所有** 物理机插入 U 盘并安装系统，注意 BIOS 设置 **USB 启动** 为第一优先级，重启设备会自动开始安装系统，请耐心等待几分钟。

### 第三步：配置服务器基本信息

配置方式与本文[场景一：一体机初始化](#场景一一体机初始化)一致，可参考一体机配置的步骤。


### 第四步：访问 Web Installer

本步骤与本文[场景一 的 第二步：访问Web Installer](#第二步访问 Web Installer)一致。

浏览器中输入之前填写的**启动节点**的 IP `http://IP:9998/` 即可访问登陆界面，默认登录用户名密码为 `admin/zhu88jie`。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525204851.png)

## 使用 Web Installer 安装

登录 Web Installer 后，请参考 [使用 Web Installer 安装](web-installer.html) 开始安装。

