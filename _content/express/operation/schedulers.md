---
---

# 定时器

定时器（Scheduler）功能可用来周期性地执行一系列的资源操作任务，比如根据业务需要定时开关主机、创建主机和创建备份等。可在指定的周期重复执行，也可仅执行一次，且每个任务支持多个资源批量操作。任务执行后会发出通知到用户指定的通知列表并保留近期执行的历史记录。

目前支持的定时任务有：


- 关闭主机
- 开启主机
- 重启主机
- 创建备份 (主机、硬盘)


## 创建定时器

1、登录 Express，选择 「运维工具」 → 「定时器」，点击 「创建定时器」。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525172529.png)

2、在弹窗中参考如下填写定时器的基本信息：


> - 名称：为定时器起一个简洁明了的名称，便于用户浏览和搜索
> - 发送通知：支持重复执行或仅执行一次
> - 周期：支持每天、每 N 天、每 N 小时、每周、每月
> - 时间：设置定时器的执行时间
> - 推送条件：可根据执行状态推送至消息中心


例如，以创建一个每天 17:35 定时备份主机的定时任务为例，演示定时器的作用。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190415141800.png)

3、例如，参考以下示例添加主机 `docs-demo` 作为备份对象，并开启**自动删除旧备份链**。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525172910.png)

4、创建定时任务后，可以看到定时任务显示 “已启用”，后续观察定时任务所操作的主机资源 `docs-demo`，是否能够成功创建主机备份。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190525173458.png)

## 验证定时任务

点击 `docs-demo` 进入主机详情页，切换到 「备份」 页面，可以看到定时器 Scheduler 创建的全量备份，根据创建时间和备份名称 (create by scheduler [schd-pkbhgcg8]) 可以确定验证主机定时备份创建成功。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190415165216.png)

## 立即执行任务

默认情况下，任务都是在到达设定的时间才会被触发。 为了更便于用户使用，我们提供了立即执行功能，可以随时触发已创建的定时任务。 每次执行完也会将结果保存到历史记录中。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190415170110.png)

## 查看历史记录

定时器的每次任务执行结果都会保存在历史记录中，切换到历史记录即可查看。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190415170147.png)