---
---

# 备份

备份（Snapshot）通常用于在块设备级别上进行硬盘的备份与恢复， 可以同时对多张硬盘做备份（包括系统盘和数据盘），也可以对正在运行的主机做在线备份。 一张硬盘可以有多个备份链，每条备份链包括一个全量备份点以及多个增量备份点， 您可以随时从任意一个备份点恢复数据。

## 基本概念

### 术语解释

在开始备份操作示例前，先对高频术语、功能特性简单说明：

> - **全量备份点**： 对硬盘当前状态的全量拷贝；
> - **增量备份点**： 对硬盘当前状态的增量拷贝，即只保存相对于上一个备份点的变化量；
> - **备份链**： 备份链包括一个全量备份点和多个增量备份点。每次做全量备份都会产生一个新的备份链。
> - **回滚至备份点**：备份点名称 则表示放弃资源当前状态

### 备份功能特性

用户可以对一块或多块硬盘（包括系统盘和数据盘）创建备份，青立方备份功能有以下几点特性：

> - **基本备份**：你可以对主机的系统盘进行备份，也可以对数据盘进行备份。
> - **在线备份**：你可以对正在运行的主机进行备份，也可以对正在使用的数据盘进行备份。备份操作不会影响或者中断你业务的运行。
> - **并行备份**：你可以同时对多块硬盘（包括系统盘和数据盘）进行备份，如果这些硬盘同属于一个主机，则在备份时会保证这些硬盘数据的一致性，即都是同一时刻的状态。
> - **全量与增量备份**：你可以对硬盘（包括系统盘和数据盘）进行全量或者增量备份。当进行全量备份时，会生成一条新的备份链，之后创建的备份默认都是增量备份。

### 备份与实时副本的区别

青立方超融合易捷版的硬盘（包括系统盘和数据盘）都是有多份 **实时副本** 的，即数据的写入只有在多个副本上都完成后才算成功，实时副本可以保证硬件设备出现问题时数据不丢失。

>说明： **备份** 是用于捕捉硬盘在某一个时刻的状态，未来可以随时恢复到这个状态。 在某些时候，例如误操作或者应用逻辑的 bug，可能会导致业务数据的丢失， 这种情况下实时副本无法恢复数据，因为硬件设备并没有问题。这时候，就需要通过备份，从历史备份点恢复数据。
> 
> 即，实时副本主要用于灾难恢复；而备份则是用于保存业务数据的里程碑 （milestone）状态，以便在从业务到硬件的任何一个层面出问题时恢复数据。

## 创建备份

### 基于主机创建备份

> 前提条件：已创建了一台主机且主机挂载了硬盘，若还未创建请参考 [主机](../virtual/vm.html) 和 [硬盘](../virtual/volume.html) 预先创建。

1、在虚拟机列表页，进入 docs-demo 主机详情页。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527010232.png)

2、选择 「备份」，点击 「新增全量备份链」。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527010459.png)

3、填写名称并勾选主机上需要备份的硬盘 (数据盘)，点击 「创建」，备份创建完成，创建过程通常需要几十秒左右时间。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527010859.png)

4、在顶部选择 「备份」，在备份列表中即可查看到基于主机创建的备份，包括主机的数据盘 (100 G) 和系统盘 (20 G)，基于这两个备份可以分别创建硬盘和创建镜像。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527011058.png)

### 基于硬盘创建备份

1、参考如下步骤，在硬盘列表点击其中一块硬盘点击 **···**，选择 「创建备份」，在弹窗中名字填写 `backup-vol`，点击 「创建」，创建过程通常需要几十秒左右时间。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527011557.png)

2、在顶部选择 「备份」，在备份列表中即可查看到基于硬盘创建的备份，此时的 `backup-vol` 相当于是硬盘的全量备份，基于这个备份可以创建硬盘，还可以在此基础上创建增量备份。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527012039.png)


> 警告：当你对正在运行的主机或者已经绑定的硬盘做在线备份时，需要注意以下两点：
> 
> *  备份只能捕获在备份任务开始时已经写入磁盘的数据，不包括当时位于缓存里的数据。
> *  为了保证数据的完整性，你需要在创建备份前暂停所有文件的写操作，直到备份进入”捕获完成”的状态。或者先停止主机或解绑硬盘，进行离线备份。

### 创建增量备份

在存储进行全量备份后，即可对其创建增量备份。进入备份详情页，点击全量备份的上面的 **+** 图标即可创建增量备份。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527013312.png)

## 基于备份创建资源

### 基于备份创建镜像

平台还支持基于备份创建镜像，当备份点是基于主机系统盘创建时，通过这个备份点可以创建新的镜像，基于该镜像可以创建多台和备份点状态相同的主机。

若您的虚拟机已经创建过备份，可基于其中的一个备份点创建镜像，参考 [基于虚拟机创建镜像](../virtual/image.html#基于虚拟机创建镜像)。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527012840.png)

### 基于备份创建硬盘

当备份点是基于硬盘创建时，通过这个备份点可以创建新的硬盘，该新硬盘将拥有和备份点相同的数据。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527013052.png)

## 备份回滚

当用户因为误操作或者应用逻辑的 bug 而导致业务数据的丢失时，可以通过 “回滚” 操作恢复到某个备份点的状态。

> 注意：如果系统盘或者数据盘对应的主机正在运行，为安全的恢复数据，回滚时主机会重启。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527013518.png)

## 删除备份

用户可以删除整个备份链，也可以删除某一个备份点。

> 注意，同一条备份链上的备份点之间的数据有依赖关系。当删除备份链上的全量备份点时，会删除整条备份链。 如果删除增量备份点，所有直接或者间接依赖于这个备份点的后序节点都会被删除，请谨慎操作。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190527013731.png)





