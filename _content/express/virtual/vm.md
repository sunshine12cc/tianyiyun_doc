---
---

# 虚拟机

虚拟机就是一台配置好了的服务器，您可以按需申请期望的硬件配置、操作系统和网络配置。每一台虚拟机都具有独立的网络 IP 地址，可运行应用服务，是 CloudCube Express 的核心组成部分。

## 创建虚拟机

CloudCube Express 支持单个/批量创建虚拟机。

登录 CloudCube Express ，选择 「虚拟资源」，进入虚拟机管理列表。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190523203435.png)


点击 「+ 创建虚拟机」，在弹窗中填写虚拟虚拟机的操作系统、配置、存储、网络以及登录等信息。

![弹窗信息](https://pek3b.qingstor.com/kubesphere-docs/png/20190330140800.png)

### 操作系统

其中，操作系统支持基于系统镜像和自有镜像进行创建，镜像是带有操作系统的虚拟机模板。


**系统镜像**

目前系统镜像支持如下四种系统类型的镜像：

> - CentOS： 7.x\6.x\5.x (32 位 / 64 位)
> - Ubuntu Server：16.x\15.x\14.x\13.x\12.x\ (32 位 / 64 位)
> - Windows Server： 2003\2008\2012\2016\7 (32 位 / 64 位)
> - Fedora：18\20\22\24 (32 位 / 64 位)

**自有镜像**

自有镜像需要预先在镜像资源中进行注册，或者捕获一个虚拟机来自行创建，详情可参考 [镜像](image.html)。

### 配置

系统默认内置了以下三类常用的配置，适用于不同访问量要求的业务，另外也支持用户根据自己的业务需求进行**自定义配置**。

> - 入门配置 1核 1GB：适用于有一定访问量的业务
> - 普及配置 2核 4GB：适用于并发适中的业务或普通数据处理
> - 专业配置 4核 8GB：适用于并发要求较高的业务

### 存储

默认情况下，系统盘最低为 20 GB。若用户有更大的存储需求，支持额外挂载数据盘至虚拟机。挂载数据盘需要预先创建硬盘，参考 [硬盘](volume.html)。

### 网络

目前网络支持随机分配和选择基础网络两种方式。

> - 随机分配：系统将随机申请虚拟网卡 (主网卡) 并分配到虚拟机。
> - 选择基础网络：选择已有的其中一个 IP 组后，将为虚拟机分配一个其网段内的网络 IP 地址，支持自定义网段。

详情可参考网络章节。

![网络](https://pek3b.qingstor.com/kubesphere-docs/png/20190330170004.png)

### 登录设置

目前支持添加 SSH 密钥和密码等两种方式登录：

> - SSH 密钥：需要预先创建。相对于用户名密码方式，密钥方式拥有更强的安全性，也可以很大程度阻止暴力破解的发生。目前常用的密钥都是非对称性的加密方式，虚拟机内置公钥，而用户则拥有私钥。由于采用非对称加密，入侵者试图通过公钥去破解私钥难度会远远超出密码的破解。
> - 密码：相较于密钥，通过用户名和密码连接更加的简单易用。

详情可参考 [SSH 密钥](ssh.html)。

### 预览页

完成基本的配置信息后，可在右侧预览基础信息。

> - 名称：为虚拟机起一个简洁明了的名称，便于用户浏览和搜索。若不填则默认使用虚拟机 IP 作为名称。
> - 副本策略：支持单副本和两副本。
>   - 单副本：即数据存放时，只会产生一份副本，没有冗余副本进行保护。对于一些自身拥有副本保护机制的集群应用，例如 Hadoop 在虚拟机层面开放单副本策略，将避免两层副本机制的重叠。
>   - 多副本：即数据存储时，会产生多份实时副本，并存放于同一数据中心的不同物理节点。通过多副本保护机制，数据将拥有冗余副本，当数据所存放的物理节点宕机时，能够通过其他物理节点的副本对数据进行实时恢复，确保数据存储的高可靠性，以及相关服务的高可用性。

完成以上配置信息后，点击 「创建」 即可创建一台虚拟机，虚拟机的配置即用户在创建表单中填写的期望配置。

## 查看新建的虚拟机

如下所示，当前成功创建了一台 1 核 CPU 2 GB 内存的虚拟机，操作系统为 CentOS 7.5，其系统盘为 20 GB。创建时长随实际的硬件配置而有所不同，范围一般在几秒到几十秒。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190523203320.png)

## 连接虚拟机

连接虚拟机的方式根据不同的系统类型 (Linux、Windows) 有不同的连接方法。

### 浏览器 Web 连接

1、进入主机列表页，点击 「连接远程桌面」的图标，将自动打开远程连接 ( VNC ) 的会话窗口。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524165954.png)

2、输入设置的用户名和密码即可。注意，如果主机不接受您的密码，您可以先关闭主机，然后修改主机密码。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524170220.png)

### Linux 主机

#### 通过 SSH Terminal 终端连接

若 Linux 主机网络与终端设备在同一内网环境中，可直接通过命令 `ssh root@IP -p 22` 和 root 用户密码来登录虚拟机。注意，ubuntu 主机的默认登录用户为 ubuntu 而非 root 用户。

#### 通过 SSH 密钥连接

相对于用户名密码方式，密钥方式拥有更强的安全性，也可以很大程度阻止暴力破解的发生。目前常用的密钥都是非对称性的加密方式，主机内置公钥，而用户则拥有私钥。由于采用非对称加密，入侵者试图通过公钥去破解私钥难度会远远超出密码的破解。可参考 [SSH 密钥](ssh.html)。

#### 通过第三方软件连接

1、除了通过 VNC 连接外，您也可以通过第三方软件连接至虚拟机，常见的软件有 [PuTTY](https://www.putty.org/) 、[Xshell](https://www.netsarang.com/zh/xshell/)。

2、例如使用 Putty，在 Session 页面输入 IP 地址，点击 Open。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171029.png)

3、输入用户名和密码即可登录。

### Windows主机

从安全考虑，平台上的 Windows 主机默认关闭了远程登录，您首先需要通过浏览器 Web 方式登录到主机，并开启远程登录功能

#### 第一步：Windows Server 开启远程登录

1、浏览器打开 VNC，连接 Windows Server。

2、在 Web 登录页面，点击左上角 `Ctrl-Alt-Del` ，然后输入设置的密码。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171546.png)

3、同意内部网络共享。

登录后会弹出网络共享的界面，点击 `是`，允许VPC内部的网络。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171636.png)

4、打开系统属性。

在 Windows 主机中，点击下方文件管理器，依次点击 `此电脑` - `计算机` - `系统属性`。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171722.png)

5、允许远程桌面连接。

然后，点击 `远程设置` ，在远程桌面处选择 `允许远程桌面连接`。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171800.png)

#### 第二步：Windows 远程桌面连接

您可以通过 Windows 系统自带的 `远程桌面连接` 连接 Windows Server ，然后输入用户名密码即可。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190524171852.png)

## 管理虚拟机

在虚拟机的列表页，支持查看虚拟机的状态、镜像、网络 IP和绑定的资源，以及 CPU、内存系统盘的使用率。

勾选虚拟机，支持对虚拟机进行以下操作：

- 运行中的虚拟机
    - 修改：支持修改虚拟机的名称和描述信息。
    - 关闭：将处于运行状态的虚拟机停止。
    - 重启：将处于运行状态的虚拟机重启。
    - 迁移主机：可将虚拟机从当前物理节点迁移至另一个物理节点。
    - 安置策略组：将主机加入/离开[安置策略组](../operation/instance_groups.html)。
    - 修改最大配置：修改最大配置前请确定虚拟机处于**关机状态**。设置最大升级CPU、内存为虚拟机在开机情况下升级配置的最大条件，并占用物理节点的使用额度，请按实际计算需求选择。
    - 更改配置：更改虚拟机的CPU和内存配置。
    - 克隆主机：克隆虚拟机功能可以让虚拟机在运行的状态下，创建出一份具有相同配置、内网网段、系统盘、挂载数据盘的虚拟机，有助于业务不中断服务时方便地进行环境复制。
    - 网络：可将虚拟机加入/离开 IP 组的基础网络，详见 [IP 池](ip-pool.html)。
    - 硬盘：可以挂载/卸载硬盘，挂载硬盘后可作为虚拟机的数据盘使用，详见 [硬盘](volume.html)。
    - 绑定 SSH 密钥（可选）：绑定 SSH 密钥可以为虚拟机的 root 用户设置 SSH 密钥，当虚拟机启动后用户可使用 SSH 私钥进行 SSH 无密码登录，详见 [SSH 密钥](ssh.html)。
    - 防火墙：可以加入或离开防火墙。默认内网互通，需要配置防火墙跟其他用户隔离，系统为每个用户提供了一个缺省防火墙，在虚拟机创建后默认绑定至该虚拟机上。
    - 告警策略：可以绑定或解绑告警策略。添加后，系统可自动监控已添加虚拟机 CPU、磁盘、网卡、内存相关的多项告警条目，详见 [告警](../operation/alert.html)。
- 重置系统：重置后，虚拟机的系统盘内所有数据将被清除，恢复到初始状态。
    - 标签：标签是区别于资源名称和资源简介的用于标记资源的符号。随着资源和功能越来越丰富，场景化和批量化操作越来越多，标签更适合高效快捷管理资源。
    - 删除：将虚拟机删除并加入回收站，若需要恢复还可以从 「运维工具」 → 「回收站」 进行恢复。
    
- 停止状态的虚拟机
    - 修改：支持修改虚拟机的名称和描述信息。
    - 启动：将处于停止状态的虚拟机启动。
    - 救援虚拟机：系统将创建一台虚拟机，挂载您当前等待救援虚拟机的系统盘，您可以在救援虚拟机上管理系统盘数据，需要在创建救援虚拟机时设置密码。
    - 迁移主机：可将虚拟机从当前物理节点迁移至另一个物理节点。
    - 制作成镜像：系统可以对虚拟机进行定制并保存为镜像模板文件，详见 [镜像](image.html)。
    - 安置策略组：将主机加入/离开[安置策略组](../operation/instance_groups.html)。
    - 修改最大配置：设置最大升级CPU、内存为虚拟机在开机情况下升级配置的最大条件，并占用物理节点的使用额度，请按实际计算需求选择。
    - 更改配置：支持修改虚拟机的 CPU、内存和系统盘等配置。
    - 克隆虚拟机：克隆虚拟机功能可以让虚拟机在运行的状态下，创建出一份具有相同配置、内网网段、系统盘、挂载数据盘的虚拟机，有助于业务不中断服务时方便地进行环境复制。
    - 网络：可将虚拟机加入/离开 IP 组的基础网络，详见 [IP 池](ip-pool.html)。
    - 硬盘：可以挂载/卸载硬盘，挂载硬盘后可作为虚拟机的数据盘使用，详见 [硬盘](volume.html)。
    - 绑定 SSH 密钥（可选）：绑定 SSH 密钥可以为虚拟机的 root 用户设置 SSH 密钥，当虚拟机启动后用户可使用 SSH 私钥进行 SSH 无密码登录，详见 [SSH 密钥](ssh.html)。
    - 防火墙：可以加入或离开防火墙。默认内网互通，需要配置防火墙跟其他用户隔离，系统为每个用户提供了一个缺省防火墙，在虚拟机创建后默认绑定至该虚拟机上。
    - 告警策略：可以绑定或解绑告警策略。添加后，系统可自动监控已添加虚拟机 CPU、磁盘、网卡、内存相关的多项告警条目，详见 [告警](../operation/alert.html)。
    - 重置系统：重置后，虚拟机的系统盘内所有数据将被清除，恢复到初始状态。
    - 重置密码：修改虚拟机 root 用户的 SSH 登录密码。
    - 绑定标签：标签是区别于资源名称和资源简介的用于标记资源的符号。随着资源和功能越来越丰富，场景化和批量化操作越来越多，标签更适合高效快捷管理资源。
    - 删除：将虚拟机删除并加入回收站，若需要恢复还可以从 「运维工具」 → 「回收站」 进行恢复。
    
- 删除状态的虚拟机
    - 支持恢复、彻底删除的操作。

> 注解：克隆原虚拟机需要原虚拟机使用的镜像是可用状态。如果原虚拟机启动的镜像被删除了的话，克隆会失败。

> 注解：更改虚拟机配置中的 CPU 拓扑结构，目前虚拟机支持的 CPU 体系结构包括 Westmere、SandyBridge、IvyBridge、Haswell、Broadwell，各体系结构支持的指令集参考 [CPU 体系结构指令集](https://docs.qingcloud.com/product/computing/cpu_instruction_set)，拓扑结构的相关说明参考 [List of Intel CPU microarchitectures - Wikipedia](https://en.wikipedia.org/wiki/List_of_Intel_CPU_microarchitectures)。

![管理虚拟机](https://pek3b.qingstor.com/kubesphere-docs/png/20190403215849.png)


### 查看虚拟机资源监控

点击列表页的虚拟机进入详情页面，支持对虚拟机的实时性能监控，包括：CPU、内存、磁盘、网卡，监控数据自动实时更新，可选择的时间跨度：最近 6 小时、1 天、2 周、1 个月。

#### CPU 使用率

支持选择不同的时间跨度来监控虚拟机 CPU 的实时使用率（单位：%）。

![CPU 使用率](https://pek3b.qingstor.com/kubesphere-docs/png/20190410131720.png)

#### 内存使用率

支持选择不同的时间跨度来监控虚拟机内存的实时使用情况（单位：%）。
![内存使用率](https://pek3b.qingstor.com/kubesphere-docs/png/20190410131943.png)

#### 逻辑硬盘监控

支持选择不同的时间跨度来监控虚拟机磁盘的实时读/写情况，支持查看实时数据，分为逻辑分区 (逻辑盘) 监控和逻辑硬盘 (物理盘) 监控，提供以下三个监控指标：

- 系统盘使用率 （单位：%   间隔：5分钟）
- IOPS 监控 （读/写，单位：IOPS    间隔：5分钟）
- 吞吐量监控 (读/写，单位：B/s    间隔：5分钟)

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190410134050.png)

### 网卡监控

点击 「网卡监控」 切换到虚拟机的网卡监控页，支持查看实时流量监控，可选择的时间跨度：`最近 6 小时、1 天、2 周、1 个月`，提供以下两类监控指标：

- 网络流量监控 (出/入流量  单位：bps 间隔：5分钟)
- 包转发率监控 (出/入流量  单位：pps 间隔：5分钟)

![网卡监控](https://pek3b.qingstor.com/kubesphere-docs/png/20190410135812.png)

### 备份

Express 提供完善可靠的备份方式与备份工具，支持在线备份、增量备份和备份链功能，并通过某一个备份点创建相应的资源（如虚拟机、虚拟硬盘等）。例如，虚拟机支持全量及增量备份 (包含备份链管理和基于某一备份点的新资源创建及备份状态回滚)。

切换到 「备份」 页面，点击 「新建全量备份链」，在弹窗中填写名称即可创建虚拟机备份。创建后支持修改、创建硬盘和删除备份。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190523204237.png)

> 提示：创建备份后，可使用备份中心集中管理备份，监控全平台的备份活动，或从备份还原平台资源，并且能够直观监控备份空间使用情况，每个备份链包括一个全量备份点以及多个增量备份点，您可以随时从任意一个备份点恢复数据，详见 [备份](../backup)。

> 提示：备份支持通过创建定时任务来实现虚拟机自动备份，参考 [定时器](../operation/schedulers.html#schedulers)。

### 监控告警

您可以使用监控告警（Alert）服务对自己的虚拟机进行状态监控，并针对资源的监控属性制定告警规则，在资源状态异常时发出警告。切换至 「监控告警」 点击 「绑定」，然后创建监控告警，参考 [监控告警](../operation/alert) 创建监控告警策略。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190523204436.png)

### 操作日志

操作日志提供虚拟机的操作历史记录包括操作事项、时间、对象资源、操作任务状态以及执行时长，可以根据资源的 ID 进行搜索相关的操作事项。

![](https://pek3b.qingstor.com/kubesphere-docs/png/20190523204708.png)

